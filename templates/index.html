<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  <title>DTA Predict</title>
</head>
<body>
  <header>
    <h1>Drug-target binding affinity prediction</h1>
    <p>Predicting drug-target affinity with KIBA dataset</p>
  </header>


  <form id="DTAPredictForm">
    <p>
      Enter your drug molecule in SMILES format and your protein sequence to compute the drug-target binding affinity score
    </p>
    <label for="smiles">Drug molecule: SMILES sequence</label>
    <input type="text" id="smiles" placeholder="CC1=C2C=C(C=CC2=NN1)C3=CC(=CN=C3)OCC(CC4=CC=CC=C4)N">

    <label for="protein">Protein sequence</label>
    <input type="text" id="protein" placeholder="MKKFFDSRREQGGSGLGSGSSGGGGSTSGLGSGYIGRVFGIGRQQVTVDEVLAE">

    <button type="submit">Predict affinity score</button>
    <button type="button" id="visualize_button">Visualize drug molecule</button>
  </form>

  <div id="output">
    <div id="affinity_score"></div>
    <div id="score_bar_container">
      <div id="score_bar_indicator"></div>
    </div>
    <img id="mol_image" src="" alt="Molecule Image">
  </div>

  <script>
    document.getElementById("DTAPredictForm").onsubmit = async function (e) {
      e.preventDefault();
      const smiles = document.getElementById("smiles").value;
      const protein = document.getElementById("protein").value;
      const response = await fetch('/predict', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ smiles, protein })
      });
      const data = await response.json();
      document.getElementById("affinity_score").innerText = "Predicted KIBA affinity score: " + data.score;

      const min_score = 8;
      const max_score = 16;
      const percent = Math.min(100, Math.max(0, ((data.score - min_score) / (max_score - min_score)) * 100));
      document.getElementById("score_bar_indicator").style.left = percent + "%";
    };

    document.getElementById("visualize_button").onclick = async function (e) {
      e.preventDefault();
      const smiles = document.getElementById("smiles").value;
      const response = await fetch('/visualize', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ smiles })
      });
      const data = await response.json();
      document.getElementById("mol_image").src = "data:image/png;base64," + data.image;
    };
  </script>
</body>
</html>
